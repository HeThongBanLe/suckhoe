<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng Dụng Đăng Nhập Firebase</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged, 
            updatePassword, 
            createUserWithEmailAndPassword 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            onSnapshot, 
            doc, 
            updateDoc, 
            deleteDoc,
            query,
            where
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Cấu hình Firebase của bạn đã được thêm vào đây
        const firebaseConfig = {
            apiKey: "AIzaSyBLc2DYfVdxHdUDQhY9UrX0XlDuXH_NO7Q",
            authDomain: "suckhoe-4777a.firebaseapp.com",
            projectId: "suckhoe-4777a",
            storageBucket: "suckhoe-4777a.firebasestorage.app",
            messagingSenderId: "752106860226",
            appId: "1:752106860226:web:a245b5daedab3b0aca155b",
            measurementId: "G-38JCCTKRGM"
        };
        
        // Khởi tạo Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI elements
        const loginForm = document.getElementById('login-form');
        const header = document.getElementById('main-header');
        const mainContent = document.getElementById('main-content');
        const loginEmailInput = document.getElementById('login-email');
        const loginPasswordInput = document.getElementById('login-password');
        const loginErrorMsg = document.getElementById('login-error-msg');
        const userEmailDisplay = document.getElementById('user-email-display');
        const addUserBtn = document.getElementById('add-user-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const messageBox = document.getElementById('message-box');
        const messageContent = document.getElementById('message-content');
        const messageCloseBtn = document.getElementById('message-close-btn');
        const changePasswordModal = document.getElementById('change-password-modal');
        const addAccountModal = document.getElementById('add-account-modal');

        // Elements for profile management
        const profileAddBtn = document.getElementById('add-profile-btn');
        const profileList = document.getElementById('profile-list');
        const profileModal = document.getElementById('profile-modal');
        const profileForm = document.getElementById('profile-form');
        const profileIdInput = document.getElementById('profile-id');
        const profileNameInput = document.getElementById('profile-name');
        const profileAgeInput = document.getElementById('profile-age');
        const profileAddressInput = document.getElementById('profile-address');
        const profileNoteInput = document.getElementById('profile-note');
        const profileSaveBtn = document.getElementById('save-profile-btn');
        const profileCancelBtn = document.getElementById('cancel-profile-btn');
        const profileModalTitle = document.getElementById('profile-modal-title');
        const deleteConfirmModal = document.getElementById('delete-confirm-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        let profileToDeleteId = null;

        // Elements for health data management
        const healthDataSection = document.getElementById('health-data-section');
        const healthDataForm = document.getElementById('health-data-form');
        const healthDataList = document.getElementById('health-data-list');
        const healthDataFormNoteInput = document.getElementById('health-note');
        const healthDataCloseBtn = document.getElementById('close-health-data-btn');
        let currentProfileId = null;

        // Function to show custom message box
        function showMessage(msg) {
            messageContent.textContent = msg;
            messageBox.classList.remove('hidden');
        }

        // Authentication state management
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in
                loginForm.classList.add('hidden');
                header.classList.remove('hidden');
                mainContent.classList.remove('hidden');
                userEmailDisplay.textContent = user.email;

                // Only show "Add user" button for admin
                if (user.email === 'admin@myapp.com') {
                    addUserBtn.classList.remove('hidden');
                } else {
                    addUserBtn.classList.add('hidden');
                }

                // Start listening for profile data
                listenForProfiles();

            } else {
                // User is signed out
                loginForm.classList.remove('hidden');
                header.classList.add('hidden');
                mainContent.classList.add('hidden');
                loginPasswordInput.value = ''; // Clear password field on sign out
                profileList.innerHTML = ''; // Clear profiles on sign out
                healthDataSection.classList.add('hidden'); // Hide health data section
            }
            loadingIndicator.classList.add('hidden');
        });

        // Event listeners
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = loginEmailInput.value;
            const password = loginPasswordInput.value;
            loginErrorMsg.textContent = '';
            loadingIndicator.classList.remove('hidden');
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                // The onAuthStateChanged listener will handle the UI update upon success
            } catch (error) {
                const errorMessage = "Đăng nhập thất bại. Vui lòng kiểm tra lại email và mật khẩu.";
                loginErrorMsg.textContent = errorMessage;
                console.error(error);
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        });

        document.getElementById('logout-btn').addEventListener('click', async () => {
            loadingIndicator.classList.remove('hidden');
            try {
                await signOut(auth);
            } catch (error) {
                showMessage("Đăng xuất thất bại. Vui lòng thử lại.");
                console.error(error);
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        });

        document.getElementById('change-password-btn').addEventListener('click', () => {
            changePasswordModal.classList.remove('hidden');
        });

        document.getElementById('confirm-change-password').addEventListener('click', async () => {
            const newPassword = document.getElementById('new-password-input').value;
            if (newPassword.length >= 6) {
                changePasswordModal.classList.add('hidden');
                loadingIndicator.classList.remove('hidden');
                updatePassword(auth.currentUser, newPassword)
                    .then(() => {
                        showMessage("Mật khẩu đã được đổi thành công!");
                    })
                    .catch((error) => {
                        showMessage("Thay đổi mật khẩu thất bại. Vui lòng thử lại sau.");
                        console.error(error);
                    })
                    .finally(() => {
                        loadingIndicator.classList.add('hidden');
                    });
            } else {
                showMessage("Mật khẩu phải có ít nhất 6 ký tự.");
            }
        });

        document.getElementById('cancel-change-password').addEventListener('click', () => {
            changePasswordModal.classList.add('hidden');
        });

        addUserBtn.addEventListener('click', () => {
            addAccountModal.classList.remove('hidden');
        });

        document.getElementById('confirm-add-account').addEventListener('click', async () => {
            const newEmail = document.getElementById('new-email-input').value;
            const newPassword = document.getElementById('new-password-add-input').value;

            if (newEmail && newPassword.length >= 6) {
                addAccountModal.classList.add('hidden');
                loadingIndicator.classList.remove('hidden');
                try {
                    await createUserWithEmailAndPassword(auth, newEmail, newPassword);
                    showMessage("Tài khoản mới đã được thêm thành công!");
                } catch (error) {
                    showMessage("Tạo tài khoản thất bại. Vui lòng kiểm tra email hoặc thử lại.");
                    console.error(error);
                } finally {
                    loadingIndicator.classList.add('hidden');
                }
            } else {
                showMessage("Vui lòng nhập email hợp lệ và mật khẩu ít nhất 6 ký tự.");
            }
        });

        document.getElementById('cancel-add-account').addEventListener('click', () => {
            addAccountModal.classList.add('hidden');
        });

        messageCloseBtn.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        // --- Profile Management Logic ---
        profileAddBtn.addEventListener('click', () => {
            profileModalTitle.textContent = "Thêm Hồ Sơ Mới";
            profileForm.reset();
            profileIdInput.value = '';
            profileModal.classList.remove('hidden');
        });

        profileCancelBtn.addEventListener('click', () => {
            profileModal.classList.add('hidden');
        });

        profileForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const profileId = profileIdInput.value;
            const user = auth.currentUser;
            if (!user) {
                showMessage("Bạn cần phải đăng nhập để lưu hồ sơ.");
                return;
            }

            const profileData = {
                name: profileNameInput.value,
                age: profileAgeInput.value,
                address: profileAddressInput.value,
                notes: profileNoteInput.value,
                createdAt: new Date(),
                // Thêm userId vào hồ sơ để dễ dàng lọc
                userId: user.uid
            };

            loadingIndicator.classList.remove('hidden');
            try {
                if (profileId) {
                    // Cập nhật hồ sơ hiện có
                    await updateDoc(doc(db, 'profiles', profileId), profileData);
                    showMessage("Hồ sơ đã được cập nhật!");
                } else {
                    // Thêm hồ sơ mới
                    await addDoc(collection(db, 'profiles'), profileData);
                    showMessage("Hồ sơ mới đã được lưu thành công!");
                }
                profileModal.classList.add('hidden');
            } catch (error) {
                showMessage("Lưu hồ sơ thất bại. Vui lòng thử lại.");
                console.error(error);
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        });

        function renderProfiles(profiles) {
            profileList.innerHTML = '';
            if (profiles.length === 0) {
                profileList.innerHTML = '<p class="text-gray-500 text-center w-full">Chưa có hồ sơ nào. Hãy thêm hồ sơ mới!</p>';
                return;
            }

            profiles.forEach(profile => {
                const profileCard = document.createElement('div');
                profileCard.id = profile.id;
                profileCard.className = 'flex-shrink-0 bg-white p-6 rounded-lg shadow-lg flex flex-col justify-between w-64 md:w-80 min-h-64';
                profileCard.innerHTML = `
                    <div>
                        <h3 class="text-xl font-bold text-indigo-600 mb-2">${profile.name}</h3>
                        <div class="space-y-1">
                            <p class="text-gray-700"><strong>Tuổi:</strong> ${profile.age}</p>
                            <p class="text-gray-700"><strong>Nơi ở:</strong> ${profile.address}</p>
                            <p class="text-gray-700"><strong>Ghi chú:</strong> ${profile.notes}</p>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2 mt-4">
                        <button class="view-btn bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300">Xem</button>
                        <button class="edit-btn bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition duration-300">Sửa</button>
                        <button class="delete-btn bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300">Xóa</button>
                    </div>
                `;
                
                // Add event listeners for buttons on each card
                profileCard.querySelector('.view-btn').addEventListener('click', () => {
                    currentProfileId = profile.id;
                    healthDataSection.classList.remove('hidden');
                    listenForHealthData(currentProfileId);
                    // Scroll to the new section
                    healthDataSection.scrollIntoView({ behavior: 'smooth' });
                });

                profileCard.querySelector('.edit-btn').addEventListener('click', () => {
                    profileModalTitle.textContent = "Sửa Hồ Sơ";
                    profileIdInput.value = profile.id;
                    profileNameInput.value = profile.name;
                    profileAgeInput.value = profile.age;
                    profileAddressInput.value = profile.address;
                    profileNoteInput.value = profile.notes;
                    profileModal.classList.remove('hidden');
                });

                profileCard.querySelector('.delete-btn').addEventListener('click', () => {
                    profileToDeleteId = profile.id;
                    deleteConfirmModal.classList.remove('hidden');
                });

                profileList.appendChild(profileCard);
            });
        }

        // Real-time listener for profiles
        function listenForProfiles() {
            const user = auth.currentUser;
            if (!user) {
                console.error("Không có người dùng nào đăng nhập.");
                return;
            }
            
            let q;
            // Nếu là admin, hiển thị tất cả hồ sơ
            if (user.email === 'admin@myapp.com') {
                q = collection(db, 'profiles');
            } else {
                // Ngược lại, chỉ hiển thị hồ sơ của người dùng hiện tại
                q = query(collection(db, 'profiles'), where("userId", "==", user.uid));
            }

            onSnapshot(q, (querySnapshot) => {
                const profiles = [];
                querySnapshot.forEach((doc) => {
                    profiles.push({ id: doc.id, ...doc.data() });
                });
                renderProfiles(profiles);
            }, (error) => {
                console.error("Lỗi khi lấy dữ liệu hồ sơ:", error);
                showMessage("Không thể tải dữ liệu hồ sơ.");
            });
        }

        // Delete confirmation modal listeners
        confirmDeleteBtn.addEventListener('click', async () => {
            deleteConfirmModal.classList.add('hidden');
            if (profileToDeleteId) {
                loadingIndicator.classList.remove('hidden');
                try {
                    await deleteDoc(doc(db, 'profiles', profileToDeleteId));
                    showMessage("Hồ sơ đã được xóa!");
                } catch (error) {
                    showMessage("Xóa hồ sơ thất bại.");
                    console.error(error);
                } finally {
                    loadingIndicator.classList.add('hidden');
                    profileToDeleteId = null;
                }
            }
        });

        cancelDeleteBtn.addEventListener('click', () => {
            deleteConfirmModal.classList.add('hidden');
            profileToDeleteId = null;
        });

        // --- Health Data Logic ---
        healthDataCloseBtn.addEventListener('click', () => {
            healthDataSection.classList.add('hidden');
            healthDataForm.reset();
            healthDataList.innerHTML = '';
        });

        healthDataForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentProfileId) {
                showMessage("Vui lòng chọn một hồ sơ trước.");
                return;
            }

            const healthData = {
                date: document.getElementById('health-date').value,
                weight: document.getElementById('health-weight').value,
                bloodPressure: document.getElementById('health-bp').value,
                heartRate: document.getElementById('health-heart-rate').value,
                sleep: document.getElementById('health-sleep').value,
                steps: document.getElementById('health-steps').value,
                notes: healthDataFormNoteInput.value,
                profileId: currentProfileId,
                createdAt: new Date()
            };

            loadingIndicator.classList.remove('hidden');
            try {
                await addDoc(collection(db, 'healthRecords'), healthData);
                showMessage("Dữ liệu sức khỏe đã được lưu thành công!");
                healthDataForm.reset();
            } catch (error) {
                showMessage("Lưu dữ liệu sức khỏe thất bại.");
                console.error(error);
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        });
        
        // Real-time listener for health data
        function listenForHealthData(profileId) {
            const q = query(collection(db, 'healthRecords'), where("profileId", "==", profileId));
            onSnapshot(q, (querySnapshot) => {
                const records = [];
                querySnapshot.forEach((doc) => {
                    records.push({ id: doc.id, ...doc.data() });
                });
                renderHealthData(records);
            }, (error) => {
                console.error("Lỗi khi lấy dữ liệu sức khỏe:", error);
                showMessage("Không thể tải dữ liệu sức khỏe.");
            });
        }

        function renderHealthData(records) {
            healthDataList.innerHTML = '';
            if (records.length === 0) {
                healthDataList.innerHTML = '<p class="text-gray-500 text-center">Chưa có dữ liệu sức khỏe nào. Hãy thêm dữ liệu mới!</p>';
                return;
            }

            // Sort by date, newest first
            records.sort((a, b) => b.createdAt.toDate() - a.createdAt.toDate());

            records.forEach(record => {
                const date = record.date ? new Date(record.date).toLocaleDateString('vi-VN') : 'N/A';
                const recordElement = document.createElement('div');
                recordElement.className = 'bg-white p-4 rounded-lg shadow-md mb-2';
                recordElement.innerHTML = `
                    <p><strong>Ngày:</strong> ${date}</p>
                    <p><strong>Cân nặng:</strong> ${record.weight || 'N/A'} kg</p>
                    <p><strong>Huyết áp:</strong> ${record.bloodPressure || 'N/A'}</p>
                    <p><strong>Nhịp tim:</strong> ${record.heartRate || 'N/A'} bpm</p>
                    <p><strong>Giấc ngủ:</strong> ${record.sleep || 'N/A'} giờ</p>
                    <p><strong>Bước chân:</strong> ${record.steps || 'N/A'}</p>
                    <p><strong>Ghi chú:</strong> ${record.notes || 'Không có'}</p>
                `;
                healthDataList.appendChild(recordElement);
            });
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen font-sans antialiased">
    <!-- Header chính (chỉ hiển thị khi đã đăng nhập) -->
    <header id="main-header" class="hidden fixed top-0 left-0 w-full bg-indigo-600 text-white shadow-md p-3 z-10">
        <div class="container mx-auto flex items-center justify-between flex-wrap">
            <span id="user-email-display" class="text-lg font-bold mr-4"></span>
            <div class="flex items-center space-x-2 flex-wrap mt-1 sm:mt-0">
                <button id="add-profile-btn" class="bg-blue-500 text-white font-bold py-1 px-3 rounded-lg hover:bg-blue-600 transition duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-xs md:text-sm">Thêm Hồ Sơ</button>
                <button id="change-password-btn" class="bg-yellow-500 text-white font-bold py-1 px-3 rounded-lg hover:bg-yellow-600 transition duration-300 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 text-xs md:text-sm">Đổi Mật Khẩu</button>
                <button id="logout-btn" class="bg-red-500 text-white font-bold py-1 px-3 rounded-lg hover:bg-red-600 transition duration-300 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 text-xs md:text-sm">Đăng Xuất</button>
                <button id="add-user-btn" class="bg-green-500 text-white font-bold py-1 px-3 rounded-lg hover:bg-green-600 transition duration-300 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 hidden text-xs md:text-sm">Thêm Tài Khoản Mới</button>
            </div>
        </div>
    </header>

    <div class="w-full max-w-7xl mx-auto p-4 md:p-8 mt-16">
        <!-- Biểu mẫu đăng nhập -->
        <div id="login-form" class="bg-white p-6 md:p-10 rounded-xl shadow-lg w-full max-w-md mx-auto">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Đăng Nhập</h2>
            <form>
                <div class="mb-4">
                    <label for="login-email" class="block text-gray-700 font-semibold mb-2">Email</label>
                    <input type="email" id="login-email" name="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="example@gmail.com" required>
                </div>
                <div class="mb-6">
                    <label for="login-password" class="block text-gray-700 font-semibold mb-2">Mật khẩu</label>
                    <input type="password" id="login-password" name="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Mật khẩu của bạn" required>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Đăng Nhập</button>
                <div id="login-error-msg" class="text-red-500 text-center mt-4"></div>
            </form>
        </div>

        <!-- Nội dung chính (sau khi đăng nhập) -->
        <div id="main-content" class="hidden mt-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 text-center">Danh sách Hồ sơ</h2>
            <div id="profile-list" class="flex overflow-x-auto space-x-4 p-4 -mx-4 pb-6">
                <!-- Hồ sơ sẽ được hiển thị ở đây -->
            </div>
        </div>

        <!-- Section nhập liệu sức khỏe -->
        <div id="health-data-section" class="hidden mt-8 p-6 bg-white rounded-xl shadow-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-semibold text-gray-700">Dữ Liệu Sức Khỏe</h3>
                <button id="close-health-data-btn" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Form nhập liệu -->
            <form id="health-data-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="health-date" class="block text-gray-700 font-medium">Ngày</label>
                    <input type="date" id="health-date" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="health-weight" class="block text-gray-700 font-medium">Cân nặng (kg)</label>
                    <input type="number" id="health-weight" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., 65">
                </div>
                <div>
                    <label for="health-bp" class="block text-gray-700 font-medium">Huyết áp</label>
                    <input type="text" id="health-bp" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., 120/80">
                </div>
                <div>
                    <label for="health-heart-rate" class="block text-gray-700 font-medium">Nhịp tim (bpm)</label>
                    <input type="number" id="health-heart-rate" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., 75">
                </div>
                <div>
                    <label for="health-sleep" class="block text-gray-700 font-medium">Giấc ngủ (giờ)</label>
                    <input type="number" id="health-sleep" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., 8">
                </div>
                <div>
                    <label for="health-steps" class="block text-gray-700 font-medium">Bước chân</label>
                    <input type="number" id="health-steps" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="e.g., 10000">
                </div>
                <div class="col-span-1 md:col-span-2">
                    <label for="health-note" class="block text-gray-700 font-medium">Ghi chú</label>
                    <textarea id="health-note" rows="3" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="Thêm ghi chú..."></textarea>
                </div>
                <div class="col-span-1 md:col-span-2 flex justify-end">
                    <button type="submit" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition duration-300">Lưu</button>
                </div>
            </form>

            <hr class="my-6">
            
            <!-- Danh sách dữ liệu sức khỏe đã lưu -->
            <div id="health-data-list" class="space-y-4">
                <!-- Dữ liệu sức khỏe sẽ được hiển thị ở đây -->
            </div>
        </div>

        <!-- Hộp thoại đổi mật khẩu -->
        <div id="change-password-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4 z-20">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full shadow-xl">
                <h3 class="text-xl font-semibold mb-4 text-center">Đổi Mật Khẩu</h3>
                <input type="password" id="new-password-input" class="w-full px-4 py-2 border rounded-lg mb-4" placeholder="Nhập mật khẩu mới" required>
                <div class="flex justify-end space-x-2">
                    <button id="cancel-change-password" class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Hủy</button>
                    <button id="confirm-change-password" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Xác Nhận</button>
                </div>
            </div>
        </div>

        <!-- Hộp thoại thêm tài khoản mới -->
        <div id="add-account-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4 z-20">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full shadow-xl">
                <h3 class="text-xl font-semibold mb-4 text-center">Thêm Tài Khoản Mới</h3>
                <input type="email" id="new-email-input" class="w-full px-4 py-2 border rounded-lg mb-2" placeholder="Email" required>
                <input type="password" id="new-password-add-input" class="w-full px-4 py-2 border rounded-lg mb-4" placeholder="Mật khẩu (ít nhất 6 ký tự)" required>
                <div class="flex justify-end space-x-2">
                    <button id="cancel-add-account" class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Hủy</button>
                    <button id="confirm-add-account" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">Thêm</button>
                </div>
            </div>
        </div>

        <!-- Hộp thoại thêm/sửa hồ sơ -->
        <div id="profile-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4 z-30">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full shadow-xl">
                <h3 id="profile-modal-title" class="text-xl font-semibold mb-4 text-center">Thêm Hồ Sơ Mới</h3>
                <form id="profile-form">
                    <input type="hidden" id="profile-id">
                    <input type="text" id="profile-name" class="w-full px-4 py-2 border rounded-lg mb-2" placeholder="Họ và tên" required>
                    <input type="number" id="profile-age" class="w-full px-4 py-2 border rounded-lg mb-2" placeholder="Tuổi" required>
                    <input type="text" id="profile-address" class="w-full px-4 py-2 border rounded-lg mb-2" placeholder="Nơi ở" required>
                    <textarea id="profile-note" class="w-full px-4 py-2 border rounded-lg mb-4" rows="3" placeholder="Ghi chú"></textarea>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cancel-profile-btn" class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Hủy</button>
                        <button type="submit" id="save-profile-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Lưu Hồ Sơ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Hộp thoại xác nhận xóa hồ sơ -->
        <div id="delete-confirm-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4 z-40">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full shadow-xl text-center">
                <p class="text-gray-700 mb-4">Bạn có chắc chắn muốn xóa hồ sơ này không?</p>
                <div class="flex justify-center space-x-2">
                    <button id="cancel-delete-btn" class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Hủy</button>
                    <button id="confirm-delete-btn" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Xóa</button>
                </div>
            </div>
        </div>

        <!-- Chỉ báo tải toàn cầu -->
        <div id="loading-indicator" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
            <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-white"></div>
        </div>
        
        <!-- Hộp thoại thông báo tùy chỉnh -->
        <div id="message-box" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4 z-40">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full shadow-xl text-center">
                <p id="message-content" class="text-gray-700 mb-4"></p>
                <button id="message-close-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-300">Đóng</button>
            </div>
        </div>
    </div>
</body>
</html>
